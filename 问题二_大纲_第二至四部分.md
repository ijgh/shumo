问题二：源域故障诊断流程大纲（更新版）
1. 数据准备
1.1 读取与字段确认
读取 Excel/CSV 数据集；
确认 label 列（故障种类）、数值特征列；
检查缺失值/异常值，必要时填补或剔除。

1.2 划分数据集
分层抽样：训练集（60%）、验证集（20%）、测试集（20%）；
确保每类故障在三个子集均有代表性。
（可选）设置留出工况数据做 OOS（Out-of-Sample）泛化检验。

2. 特征筛选（相关性分析）
2.1 计算 Pearson 与 Spearman 相关系数
将 label 转换为数值编码；
分别计算每个特征与 label 的 Pearson 与 Spearman 相关系数；
输出两张表：
按 |Pearson| 从大到小排序，取前 18 个；
按 |Spearman| 从大到小排序，取前 18 个。

2.2 特征排名与联合筛选
方法一：对两个 Top-18 取交集，计算平均相关系数再排名；
方法二：对所有特征分别计算 Pearson 与 Spearman 的排名，求平均名次，按升序排序。
最终得到 Top-12 强相关特征。

2.3 输出与可视化
表格：Top-18 by Pearson、Top-18 by Spearman、Top-12 Final；
图表：
Top-18 Pearson 条形图；
Top-18 Spearman 条形图；
Top-12 综合排名条形图；
Top-12 内部相关性热图。

3. 模型建立与训练

3.1 入模特征
使用筛选得到的 Top-12 特征作为输入特征；
Label 作为输出。

3.2 候选模型集
线性模型：Logistic Regression (L2)，Linear SVM；
树模型：Random Forest，XGBoost，LightGBM；
（可选）浅层神经网络（MLP）对照。

3.3 训练策略
在训练集上训练，验证集调参：
Logistic Regression：正则化强度 C；
SVM：核函数/γ/C；
RF：n_estimators, max_depth, max_features；
XGB/LGBM：n_estimators, max_depth, learning_rate, subsample 等。
使用 Stratified K-Fold (K=5) 交叉验证，
模型评估指标、
AUC-ROC 曲线：多分类用 One-vs-Rest 展示，能更直观体现分类边界。
Kappa 系数 / Matthews Correlation Coefficient (MCC)：比 Accuracy 更能反映样本不均衡时的性能。
学习曲线：训练集规模 vs 性能，说明模型是否过拟合/欠拟合。
 Macro-F1 与 Accuracy。

4. 测试与对比分析
4.1 测试集推理
用最优超参数在 Train+Val 上重新训练；
对 Test 数据进行预测。
噪声扰动实验：在测试特征上加入一定比例的高斯噪声，看模型性能下降幅度，体现稳健性。

4.2 结果对比
输出各模型的：Accuracy、Macro-F1、每类 Precision/Recall/F1；
混淆矩阵展示分类效果；
尝试 模型集成：
投票（Voting Classifier）：将 SVM、RF、XGB 的预测结果投票；
堆叠（Stacking）：用一层 Logistic Regression 融合多个模型的输出。
以 测试集 Accuracy 最高 作为最终最优模型（如相差很小，再看 Macro-F1 和少数类召回率）。

4.3 可视化
模型对比条形图（Accuracy & Macro-F1）；
最优模型的混淆矩阵；
各类 Precision/Recall/F1 条形图或雷达图。

5. 模型解释（为问题四准备）
全局解释：树模型特征重要度（Gain/Split）、Permutation Importance；
局部解释：对单样本用 SHAP 或 LIME 进行可解释性分析。
可视化：
Top-10 特征重要度条形图；
单样本 SHAP 瀑布图（可选）。

6. 固化与复现
保存：最优模型参数、Top-12 特征清单、Scaler；
推理脚本：输入同结构 CSV → 输出类别与概率。

产出清单
表格：
Pearson Top-18、Spearman Top-18、联合 Top-12
图表：
相关性排名图（3 张）
Top-12 内部相关性热图
各模型对比柱状图
最优模型混淆矩阵
Precision/Recall/F1 对比雷达图
特征重要度条形图
（可选）单样本解释性图
